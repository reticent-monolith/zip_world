services:
  backend:
    build: "./backend"
    networks:
      - backend
    stdin_open: true
    tty: true

  database:
    image: mysql/mysql-server
    networks:
      - backend
    volumes:
      - "./volumes/db:/data/db"
    restart: always

  broker:
    image: eclipse-mosquitto:latest
    networks:
      - frontend
    volumes:
      - "./volumes/mosquitto:/mosquitto/config"

  auth:
    image: fusionauth/fusionauth-app
    networks:
      - backend
      - frontend

  proxy:
    image: caddy:latest
    volumes:
      - "./volumes/caddy:/etc/caddy"
    networks:
      - frontend
      - backend
      - ext
    ports:
      - 4443:443

networks:
  backend:
    internal: true
  frontend:
    internal: true
  ext:
    internal: false